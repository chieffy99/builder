<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Formula Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .conversation-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .formula-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .conversation-step {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .step-icon {
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 10px;
            font-weight: bold;
        }

        .question {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #2196F3;
        }

        .question::before {
            content: "ü§ñ ";
            font-size: 1.2em;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .uncertainty-help {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .uncertainty-help::before {
            content: "üí° ";
            font-size: 1.2em;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .formula-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin-bottom: 20px;
            min-height: 200px;
            white-space: pre-wrap;
        }

        .mapping-display {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .mapping-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .mapping-item:last-child {
            border-bottom: none;
        }

        .confidence-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #4CAF50);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Interactive Formula Generator</h1>
            <p>Smart Behavior Mapping + Auto Formula Generation</p>
        </div>

        <div class="main-content">
            <!-- Conversation Panel -->
            <div class="conversation-panel">
                <h2>üìã Data Behavior Analysis</h2>
                
                <!-- Step 1: Data Input -->
                <div class="conversation-step">
                    <div class="step-title">
                        <div class="step-icon">1</div>
                        Data Sample Input
                    </div>
                    <textarea class="answer-input" id="dataInput" rows="4" 
                              placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...&#10;‡πÄ‡∏ä‡πà‡∏ô: John Smith, ABC Corp, 1500">
                    </textarea>
                </div>

                <!-- Step 2: Gentle Inquiry -->
                <div class="conversation-step">
                    <div class="step-title">
                        <div class="step-icon">2</div>
                        Behavior Questions
                    </div>
                    
                    <div class="question">
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏∞‡πÑ‡∏£‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö?
                    </div>
                    <input type="text" class="answer-input" id="behaviorAnswer" 
                           placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡πâ‡∏≤‡∏ß">
                    
                    <button class="btn btn-secondary" onclick="showUncertaintyHelp()">
                        ü§î ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à? ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                    </button>
                    
                    <div class="uncertainty-help" id="uncertaintyHelp">
                        <strong>‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?</strong><br>
                        ‚Ä¢ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢?<br>
                        ‚Ä¢ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤?<br>
                        ‚Ä¢ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠?<br>
                        ‚Ä¢ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≥‡πÑ‡∏£?
                    </div>
                </div>

                <!-- Step 3: Value Type -->
                <div class="conversation-step">
                    <div class="step-title">
                        <div class="step-icon">3</div>
                        Value Classification
                    </div>
                    
                    <div class="question">
                        ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö?
                    </div>
                    <select class="answer-input" id="valueType">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                        <option value="amount">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ/‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á</option>
                        <option value="count">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô/‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ</option>
                        <option value="price">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</option>
                    </select>
                    
                    <div class="question">
                        ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?
                    </div>
                    <select class="answer-input" id="transactionType">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                        <option value="cash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                        <option value="credit">‡πÄ‡∏ä‡∏∑‡πà‡∏≠</option>
                        <option value="special">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
                    </select>
                </div>

                <!-- Generate Button -->
                <button class="btn" onclick="analyzeAndGenerate()" style="width: 100%; font-size: 1.2em;">
                    üöÄ Generate Formulas
                </button>
            </div>

            <!-- Formula Panel -->
            <div class="formula-panel">
                <h2>‚ö° Generated Formulas</h2>
                
                <!-- Mapping Display -->
                <div class="mapping-display" id="mappingDisplay">
                    <h3>üéØ Behavior Mapping</h3>
                    <div id="mappingResults">
                        <p style="text-align: center; color: #999; padding: 40px;">
                            ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Generate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π mapping
                        </p>
                    </div>
                </div>

                <!-- Formula Output -->
                <h3>üìä Auto-Generated Formulas</h3>
                <div class="formula-output" id="formulaOutput">
// ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Generate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£

Formulas will appear here...
                </div>

                <!-- Action Buttons -->
                <button class="btn" onclick="copyFormulas()">üìã Copy Formulas</button>
                <button class="btn btn-secondary" onclick="exportToExcel()">üìà Export to Excel</button>
                <button class="btn btn-secondary" onclick="resetAll()">üîÑ Reset</button>
            </div>
        </div>
    </div>

    <script>
        // Standard Behavior Mapping
        const standardMapping = {
            entities: {
                '‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤': 'SU',
                '‡πÅ‡∏´‡∏•‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤': 'SU',
                '‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢': 'SU',
                '‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏ß': 'SU',
                '‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤': 'CU',
                '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤': 'CU',
                '‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠': 'CU',
                '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ': 'CU',
                '‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤': 'SH',
                '‡∏™‡∏≤‡∏Ç‡∏≤': 'SH',
                '‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢': 'SH',
                '‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏õ': 'MK',
                '‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢': 'MK'
            },
            actions: {
                '‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ã‡∏∑‡πâ‡∏≠': 'BY',
                '‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏ã‡∏∑‡πâ‡∏≠': 'BY',
                '‡∏™‡∏±‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤': 'BY',
                '‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Ç‡∏≤‡∏¢': 'SA',
                '‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤': 'SA',
                '‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢': 'SA',
                '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠': 'PO',
                '‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠': 'PO'
            }
        };

        function showUncertaintyHelp() {
            const helpDiv = document.getElementById('uncertaintyHelp');
            helpDiv.style.display = helpDiv.style.display === 'none' ? 'block' : 'none';
        }

        function analyzeAndGenerate() {
            const dataInput = document.getElementById('dataInput').value;
            const behaviorAnswer = document.getElementById('behaviorAnswer').value;
            const valueType = document.getElementById('valueType').value;
            const transactionType = document.getElementById('transactionType').value;

            if (!dataInput || !behaviorAnswer || !valueType || !transactionType) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á');
                return;
            }

            // Analyze behavior
            const analysis = analyzeBehavior(behaviorAnswer);
            
            // Display mapping
            displayMapping(analysis, valueType, transactionType);
            
            // Generate formulas
            generateFormulas(analysis, valueType, transactionType);
        }

        function analyzeBehavior(behaviorText) {
            const analysis = {
                entity: null,
                action: null,
                confidence: 0
            };

            // Check entity mapping
            for (const [behavior, code] of Object.entries(standardMapping.entities)) {
                if (behaviorText.includes(behavior) || behaviorText.includes(code)) {
                    analysis.entity = code;
                    analysis.confidence += 0.4;
                    break;
                }
            }

            // Check action mapping
            for (const [behavior, code] of Object.entries(standardMapping.actions)) {
                if (behaviorText.includes(behavior) || behaviorText.includes(code)) {
                    analysis.action = code;
                    analysis.confidence += 0.4;
                    break;
                }
            }

            // Smart fallback analysis
            if (!analysis.entity) {
                if (behaviorText.includes('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤') || behaviorText.includes('‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤')) {
                    analysis.entity = 'CU';
                    analysis.confidence += 0.3;
                } else if (behaviorText.includes('‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤') || behaviorText.includes('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')) {
                    analysis.entity = 'SU';
                    analysis.confidence += 0.3;
                }
            }

            if (!analysis.action) {
                if (behaviorText.includes('‡∏Ç‡∏≤‡∏¢') || behaviorText.includes('‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢')) {
                    analysis.action = 'SA';
                    analysis.confidence += 0.3;
                } else if (behaviorText.includes('‡∏ã‡∏∑‡πâ‡∏≠') || behaviorText.includes('‡∏™‡∏±‡πà‡∏á')) {
                    analysis.action = 'BY';
                    analysis.confidence += 0.3;
                }
            }

            return analysis;
        }

        function displayMapping(analysis, valueType, transactionType) {
            const mappingDiv = document.getElementById('mappingResults');
            
            const statC = valueType === 'amount' ? 'A' : valueType === 'count' ? 'B' : 'C';
            const statN = transactionType === 'cash' ? '0' : transactionType === 'credit' ? '1' : '2';
            
            const confidence = Math.min(analysis.confidence * 100, 95);
            
            mappingDiv.innerHTML = `
                <div class="mapping-item">
                    <span><strong>Entity Code:</strong></span>
                    <span>${analysis.entity || 'Unknown'}</span>
                </div>
                <div class="mapping-item">
                    <span><strong>Action Code:</strong></span>
                    <span>${analysis.action || 'Unknown'}</span>
                </div>
                <div class="mapping-item">
                    <span><strong>Field Code:</strong></span>
                    <span>${(analysis.entity || '') + (analysis.action || '')}</span>
                </div>
                <div class="mapping-item">
                    <span><strong>StatC (Value Type):</strong></span>
                    <span>${statC}</span>
                </div>
                <div class="mapping-item">
                    <span><strong>StatN (Transaction):</strong></span>
                    <span>${statN}</span>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Confidence Level:</strong>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${confidence}%"></div>
                    </div>
                    <small>${confidence.toFixed(0)}% confident</small>
                </div>
            `;
        }

        function generateFormulas(analysis, valueType, transactionType) {
            const entity = analysis.entity || 'XX';
            const action = analysis.action || 'XX';
            const statC = valueType === 'amount' ? 'A' : valueType === 'count' ? 'B' : 'C';
            const statN = transactionType === 'cash' ? '0' : transactionType === 'credit' ? '1' : '2';
            
            const formulas = `
// =============================================================
// AUTO-GENERATED FORMULAS - ${entity}${action}
// =============================================================

// 1. BASIC EXTRACTION
=SUMIFS(slot1, ID1, "${entity}", ID2, "${action}")
=SUMIFS(slot7, ID1, "${entity}", ID2, "${action}")

// 2. STATUS FILTERED
=SUMIFS(slot7, ID1, "${entity}", ID2, "${action}", StatN, "${statN}", StatC, "${statC}")
=SUMIFS(slot1, ID1, "${entity}", ID2, "${action}", StatC, "${statC}")

// 3. DATE RANGE (Last 30 days)
=SUMIFS(slot7, ID1, "${entity}", ID2, "${action}", Date, ">="&TODAY()-30)
=SUMIFS(slot1, ID1, "${entity}", ID2, "${action}", Date, ">="&A1, Date, "<="&B1)

// 4. WILDCARD PATTERNS
=SUMIFS(slot7, ID1, "${entity}*", ID2, "${action}")
=SUMIFS(slot1, ID1, "${entity}*", ID2, "${action}*")

// =============================================================
// BUSINESS ANALYSIS TEMPLATES
// =============================================================

// Total Amount (All)
Total_${entity}_${action}_Amount = SUMIFS(slot7, ID1, "${entity}", ID2, "${action}", StatC, "A")

// Cash vs Credit
Cash_${entity}_${action} = SUMIFS(slot7, ID1, "${entity}", ID2, "${action}", StatN, "0", StatC, "A")
Credit_${entity}_${action} = SUMIFS(slot7, ID1, "${entity}", ID2, "${action}", StatN, "1", StatC, "A")

// Count Analysis
Count_${entity}_${action} = SUMIFS(slot1, ID1, "${entity}", ID2, "${action}", StatC, "B")

// Price Analysis
Price_${entity}_${action} = SUMIFS(slot1, ID1, "${entity}", ID2, "${action}", StatC, "C")

// =============================================================
// TEXT/ID EXTRACTION (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠)
// =============================================================

// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å slot ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
=INDEX(slot1,MATCH(1,(ID1="${entity}")*(ID2="${action}"),0))
=INDEX(slot2,MATCH(1,(ID1="${entity}")*(ID2="${action}")*(StatN="${statN}"),0))
=INDEX(slot3,MATCH(1,(ID1="${entity}")*(ID2="${action}")*(StatC="${statC}"),0))

// ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏•‡∏≤‡∏Å‡∏•‡∏á‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ)
=IFERROR(INDEX(slot1,SMALL(IF((ID1="${entity}")*(ID2="${action}"),ROW(ID1:ID1)),ROW(A1))),"")
=IFERROR(INDEX(slot2,SMALL(IF((ID1="${entity}")*(ID2="${action}"),ROW(ID1:ID1)),ROW(A1))),"")

// ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
=INDEX(slot1,MATCH(TRUE,INDEX((ID1="${entity}")*(ID2="${action}")*(slot1<>""),0),0))

// =============================================================
// UNIQUE TEXT/ID LIST (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)
// =============================================================

// Unique Text List (Excel 365)
=UNIQUE(FILTER(slot1,(ID1="${entity}")*(ID2="${action}")*(slot1<>"")))
=UNIQUE(FILTER(slot2,(ID1="${entity}")*(ID2="${action}")*(slot2<>"")))

// Unique Text List (Excel ‡πÄ‡∏Å‡πà‡∏≤ - ‡∏•‡∏≤‡∏Å‡∏•‡∏á)
=IFERROR(INDEX(slot1,MATCH(0,COUNTIFS(ID1,"${entity}",ID2,"${action}",slot1,"<"&slot1,slot1,slot1)+COUNTIFS(\$A\$1:A1,slot1)+IF(slot1="",1,0),0)),"")

// ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Unique Text
=SUMPRODUCT((ID1="${entity}")*(ID2="${action}")*(slot1<>"")/(COUNTIFS(ID1,"${entity}",ID2,"${action}",slot1,slot1)+(slot1="")))

// =============================================================
// ID/NAME LOOKUP & REFERENCE
// =============================================================

// ‡∏´‡∏≤ ID/‡∏ä‡∏∑‡πà‡∏≠ ‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô
=INDEX(slot1,MATCH(1,(ID1="${entity}")*(ID2="${action}")*(slot7=MAX(IF((ID1="${entity}")*(ID2="${action}"),slot7))),0))
=INDEX(slot2,MATCH(1,(ID1="${entity}")*(ID2="${action}")*(slot1="[‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤]"),0))

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ ID/‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
=IF(COUNTIFS(ID1,"${entity}",ID2,"${action}",slot1,"[‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤]")>0,"FOUND","NOT_FOUND")
=IF(COUNTIFS(ID1,"${entity}",ID2,"${action}",slot2,"[ID ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤]")>0,"EXISTS","MISSING")

// =============================================================
// TEXT/ID FILTERING & SEARCH
// =============================================================

// ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (Partial Match)
=INDEX(slot1,MATCH(TRUE,INDEX(ISNUMBER(SEARCH("[‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤]",slot1))*(ID1="${entity}")*(ID2="${action}"),0),0))

// ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞
=IFERROR(INDEX(slot1,SMALL(IF(ISNUMBER(SEARCH("[‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤]",slot1))*(ID1="${entity}")*(ID2="${action}"),ROW(slot1:slot1)),ROW(A1))),"")

// ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢
=INDEX(slot1,MATCH(TRUE,INDEX((LEFT(slot1,LEN("[‡∏Ñ‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô]"))="[‡∏Ñ‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô]")*(ID1="${entity}")*(ID2="${action}"),0),0))

// =============================================================
// SLOT COMBINATIONS (‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢ slot)
// =============================================================

// ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å 2-3 slot
=INDEX(slot1&"|"&slot2,MATCH(1,(ID1="${entity}")*(ID2="${action}"),0))
=INDEX(slot1&" - "&slot2&" ("&slot3&")",MATCH(1,(ID1="${entity}")*(ID2="${action}"),0))

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ß‡∏° (Composite ID)
=INDEX("${entity}"&"${action}"&"-"&slot1&"-"&TEXT(slot7,"000"),MATCH(1,(ID1="${entity}")*(ID2="${action}"),0))

// =============================================================
// ALTERNATIVE ID SOURCES (‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
// =============================================================

// 1. ‡∏à‡∏≤‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏´‡∏•‡∏±‡∏Å (Main Fields)
// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Entity ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
=UNIQUE(ID1)
=UNIQUE(FILTER(ID1,(ID1<>"")))

// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Action ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
=UNIQUE(ID2)  
=UNIQUE(FILTER(ID2,(ID2<>"")))

// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Entity+Action ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
=UNIQUE(FILTER(ID1&ID2,(ID1<>"")*(ID2<>"")))
=UNIQUE(FILTER(ID1&"|"&ID2,(ID1<>"")*(ID2<>"")))

// 2. ‡∏à‡∏≤‡∏Å Date/Time Fields
// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
=UNIQUE(FILTER(Date,(ID1="${entity}")*(ID2="${action}")))
=UNIQUE(FILTER(datix,(datix<>"")))

// 3. ‡∏à‡∏≤‡∏Å Status Fields  
// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ StatN ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
=UNIQUE(FILTER(StatN,(ID1="${entity}")*(ID2="${action}")))

// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ StatC ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
=UNIQUE(FILTER(StatC,(ID1="${entity}")*(ID2="${action}")))

// 4. Composite ID ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ü‡∏¥‡∏•‡∏î‡πå
// Full Transaction ID
=UNIQUE(FILTER(ID1&"-"&ID2&"-"&StatN&"-"&StatC,(ID1<>"")*(ID2<>"")))

// Entity-Action-Date ID
=UNIQUE(FILTER(ID1&"-"&ID2&"-"&TEXT(Date,"YYYYMMDD"),(ID1="${entity}")*(ID2="${action}")))

// Business Process ID
=UNIQUE(FILTER(ID1&"_"&ID2&"_"&TEXT(ROW(ID1:ID1),"000"),(ID1="${entity}")*(ID2="${action}")))

// =============================================================
// REFERENCE TABLE GENERATION (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á)
// =============================================================

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Entity List
Entity_List = UNIQUE(ID1)
Action_List = UNIQUE(ID2)
Status_List = UNIQUE(StatN&"|"&StatC)

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Mapping
Entity_Action_Map = UNIQUE(ID1&" ‚Üí "&ID2)
Full_Process_Map = UNIQUE(ID1&"|"&ID2&"|"&StatN&"|"&StatC)

// ‡∏™‡∏£‡πâ‡∏≤‡∏á Index Reference
Process_Index = MATCH(ID1&ID2,UNIQUE(ID1&ID2),0)
Transaction_Index = MATCH(ID1&"|"&ID2&"|"&StatN,UNIQUE(ID1&"|"&ID2&"|"&StatN),0)

// =============================================================
// LOOKUP FROM ALTERNATIVE SOURCES
// =============================================================

// ‡∏´‡∏≤ Entity ‡∏à‡∏≤‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö
=INDEX(UNIQUE(ID1),ROW(A1))
=INDEX(UNIQUE(FILTER(ID1,(ID1<>""))),ROW(A1))

// ‡∏´‡∏≤ Action ‡∏à‡∏≤‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö  
=INDEX(UNIQUE(ID2),ROW(A1))

// ‡∏´‡∏≤ Process ‡∏à‡∏≤‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö
=INDEX(UNIQUE(ID1&ID2),ROW(A1))

// ‡∏´‡∏≤ Status ‡∏à‡∏≤‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö
=INDEX(UNIQUE(StatN&StatC),ROW(A1))

// =============================================================
// CONDITIONAL STARTING POINTS (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)
// =============================================================

// 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà "‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡πá‡∏ó‡∏£‡∏π" (Always True Conditions)
// ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ

// Base Condition: ‡∏°‡∏µ Entity ‡πÅ‡∏•‡∏∞ Action
Base_Condition = (ID1<>"")*(ID2<>"")

// Valid Transaction: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
Valid_Transaction = (ID1<>"")*(ID2<>"")*(Date<>"")*(StatN>=0)*(StatC<>"")

// Has_Data: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
Has_Data = (ID1<>"")+(ID2<>"")+(Date<>"")>0

// 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ
// ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ Entity ‡∏ô‡∏µ‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
Known_Entity = (ID1="${entity}")
Known_Action = (ID2="${action}")
Known_Status = (StatN="${statN}")*(StatC="${statC}")

// 3. ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
// ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
=FILTER(ID1,Base_Condition)
=FILTER(ID2,Base_Condition)
=FILTER(ID1&ID2,Valid_Transaction)

// ‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ
=UNIQUE(FILTER(ID1,Known_Entity*(ID2<>"")))
=UNIQUE(FILTER(ID2,Known_Action*(ID1<>"")))

// 4. Conditional Cascade (‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç)
// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á ‚Üí ‡πÅ‡∏Ñ‡∏ö
Step1_All_Entities = UNIQUE(FILTER(ID1,(ID1<>"")))
Step2_Entity_Actions = UNIQUE(FILTER(ID2,(ID1="${entity}")*(ID2<>"")))
Step3_Entity_Action_Status = UNIQUE(FILTER(StatN&StatC,(ID1="${entity}")*(ID2="${action}")*(StatN>=0)*(StatC<>"")))

// 5. Progressive Filtering (‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö)
// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ Entity
=FILTER(ID1&"|"&ID2&"|"&StatN&"|"&StatC,(ID1="${entity}")*(ID2<>"")*(StatN>=0)*(StatC<>""))

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Action
=FILTER(ID1&"|"&ID2&"|"&StatN&"|"&StatC,(ID1="${entity}")*(ID2="${action}")*(StatN>=0)*(StatC<>""))

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Status
=FILTER(ID1&"|"&ID2&"|"&StatN&"|"&StatC,(ID1="${entity}")*(ID2="${action}")*(StatN="${statN}")*(StatC="${statC}"))

// 6. Safe Lookup (‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à 100%
=IF(COUNTIF(ID1,"${entity}")>0,
   UNIQUE(FILTER(ID2,(ID1="${entity}")*(ID2<>""))),
   "NO_ENTITY_FOUND")

=IF(COUNTIFS(ID1,"${entity}",ID2,"${action}")>0,
   UNIQUE(FILTER(StatN&StatC,(ID1="${entity}")*(ID2="${action}")*(StatN>=0))),
   "NO_ACTION_FOUND")

// 7. Existence-Based Queries (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà)
// ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ slot1
=UNIQUE(FILTER(ID1&ID2,(slot1<>"")*(ID1<>"")*(ID2<>"")))

// ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ slot7 ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0
=UNIQUE(FILTER(ID1&ID2,(slot7>0)*(ID1<>"")*(ID2<>"")))

// ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö
=UNIQUE(FILTER(ID1&ID2,(slot1<>"")*(slot7>0)*(ID1<>"")*(ID2<>"")))

// =============================================================
// STEP-BY-STEP ID DISCOVERY (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô)
// =============================================================

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏´‡∏≤ Entity ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
Available_Entities = UNIQUE(FILTER(ID1,(ID1<>"")))

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏´‡∏≤ Action ‡∏Ç‡∏≠‡∏á Entity ‡∏ô‡∏±‡πâ‡∏ô  
Available_Actions = UNIQUE(FILTER(ID2,(ID1=INDEX(Available_Entities,1))*(ID2<>"")))

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏´‡∏≤ Status ‡∏Ç‡∏≠‡∏á Entity+Action ‡∏ô‡∏±‡πâ‡∏ô
Available_Status = UNIQUE(FILTER(StatN&StatC,(ID1=INDEX(Available_Entities,1))*(ID2=INDEX(Available_Actions,1))*(StatN>=0)*(StatC<>"")))

// ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏´‡∏≤ ID ‡∏à‡∏≤‡∏Å slot ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
Available_Slot_IDs = UNIQUE(FILTER(slot1,(ID1=INDEX(Available_Entities,1))*(ID2=INDEX(Available_Actions,1))*(slot1<>"")))

// =============================================================
// CONDITIONAL COUNTING & CONDITIONS
// =============================================================

// Count Unique Items
=SUMPRODUCT((ID1="${entity}")*(ID2="${action}")/(COUNTIFS(ID1,"${entity}",ID2,"${action}",slot1,slot1)+(ID1<>"${entity}")+(ID2<>"${action}")))

// Count with Multiple Conditions
=COUNTIFS(ID1,"${entity}",ID2,"${action}",StatN,"${statN}",StatC,"${statC}")
=COUNTIFS(ID1,"${entity}*",ID2,"${action}",slot7,">0")

// Exists/Check Functions  
=IF(COUNTIFS(ID1,"${entity}",ID2,"${action}")>0,"EXISTS","NOT_FOUND")
=IF(SUMIFS(slot7,ID1,"${entity}",ID2,"${action}",StatC,"A")>0,"HAS_AMOUNT","NO_AMOUNT")

// =============================================================
// ADVANCED CONDITIONAL REFERENCES
// =============================================================

// Reference ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠
Condition_${entity}_${action} = (ID1="${entity}")*(ID2="${action}")
Condition_${entity}_${action}_Cash = (ID1="${entity}")*(ID2="${action}")*(StatN="0")
Condition_${entity}_${action}_Amount = (ID1="${entity}")*(ID2="${action}")*(StatC="A")

// ‡πÉ‡∏ä‡πâ Condition ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
=SUMPRODUCT(Condition_${entity}_${action}*slot7)
=SUMPRODUCT(Condition_${entity}_${action}_Cash*slot1)
=AVERAGE(IF(Condition_${entity}_${action}_Amount,slot7))

// =============================================================
// READY-TO-USE FORMULAS
// =============================================================

// Copy these formulas directly to your Excel sheet:
${generateReadyFormulas(entity, action, statN, statC)}
            `;
            
            document.getElementById('formulaOutput').textContent = formulas;
        }

        function generateReadyFormulas(entity, action, statN, statC) {
            return `
// ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Excel ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢:

=SUMIFS(slot7,ID1,"${entity}",ID2,"${action}",StatN,"${statN}",StatC,"${statC}")
=SUMIFS(slot1,ID1,"${entity}",ID2,"${action}",StatC,"${statC}")
=SUMIFS(slot7,ID1,"${entity}*",ID2,"${action}")
=SUMIFS(slot1,ID1,"${entity}*",ID2,"${action}*")

// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á:
=SUMIFS(slot7,ID1,"${entity}",ID2,"${action}",Date,">="&TODAY()-30)
=SUMIFS(slot7,ID1,"${entity}",ID2,"${action}",StatN,"0")/SUMIFS(slot7,ID1,"${entity}",ID2,"${action}",StatN,"1")
            `;
        }

        function copyFormulas() {
            const formulaText = document.getElementById('formulaOutput').textContent;
            navigator.clipboard.writeText(formulaText).then(() => {
                alert('‡∏™‡∏π‡∏ï‡∏£‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß! üìã');
            });
        }

        function exportToExcel() {
            alert('üöß Export to Excel feature coming soon...');
        }

        function resetAll() {
            document.getElementById('dataInput').value = '';
            document.getElementById('behaviorAnswer').value = '';
            document.getElementById('valueType').value = '';
            document.getElementById('transactionType').value = '';
            document.getElementById('mappingResults').innerHTML = `
                <p style="text-align: center; color: #999; padding: 40px;">
                    ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Generate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π mapping
                </p>
            `;
            document.getElementById('formulaOutput').textContent = `// ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Generate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£

Formulas will appear here...`;
            document.getElementById('uncertaintyHelp').style.display = 'none';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Interactive Formula Generator Ready!');
        });
    </script>
</body>
</html>
